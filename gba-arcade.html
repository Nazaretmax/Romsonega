<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>GBA Arcade Italia</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #0d0d14; --card: #1a1a28; --border: #2a2a40;
  --accent: #ff3c78; --purple: #7b2ff7; --cyan: #00e5ff;
  --yellow: #ffe600; --text: #e8e8f0; --muted: #6b6b8a; --r: 10px;
}
html, body { min-height: 100%; }
body {
  background: var(--bg); color: var(--text);
  font-family: 'Inter', sans-serif; font-size: 14px;
  line-height: 1.5; overflow-x: hidden;
  -webkit-tap-highlight-color: transparent;
}
body::before {
  content: ''; position: fixed; inset: 0; pointer-events: none; z-index: 999;
  background: repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(0,0,0,0.04) 3px,rgba(0,0,0,0.04) 4px);
}

/* HEADER */
header { text-align: center; padding: 2.5rem 1rem 1.5rem; }
header::after {
  content: ''; display: block; width: 70%; max-width: 500px; height: 2px;
  margin: 1.5rem auto 0;
  background: linear-gradient(90deg,transparent,var(--accent),var(--purple),var(--cyan),transparent);
}
.logo {
  font-family: 'Press Start 2P', monospace;
  font-size: clamp(0.85rem, 3.5vw, 1.7rem); line-height: 1.5; letter-spacing: 0.02em;
  background: linear-gradient(135deg,var(--accent),var(--purple),var(--cyan));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  animation: glow 3s ease-in-out infinite;
}
@keyframes glow {
  0%,100%{filter:drop-shadow(0 0 12px rgba(255,60,120,0.3))}
  50%{filter:drop-shadow(0 0 28px rgba(123,47,247,0.5))}
}
.tagline { font-family:'Press Start 2P',monospace; font-size:0.38rem; letter-spacing:0.15em; color:var(--muted); margin-top:0.5rem; }

/* SEARCH */
.search-wrap { max-width:600px; margin:1.5rem auto 0.4rem; padding:0 1rem; position:relative; }
.search-wrap input {
  width:100%; background:var(--card); border:1px solid var(--border);
  border-radius:50px; color:var(--text); font-family:'Inter',sans-serif; font-size:1rem;
  padding:0.75rem 1.2rem 0.75rem 3rem; outline:none; -webkit-appearance:none;
  transition:border-color 0.2s,box-shadow 0.2s;
}
.search-wrap input:focus { border-color:var(--purple); box-shadow:0 0 0 3px rgba(123,47,247,0.15); }
.search-wrap input::placeholder { color:var(--muted); }
.si { position:absolute; left:1.9rem; top:50%; transform:translateY(-50%); color:var(--muted); pointer-events:none; }
.stats { text-align:center; font-family:'Press Start 2P',monospace; font-size:0.38rem; color:var(--muted); letter-spacing:0.08em; margin:0.5rem 0 1rem; }

/* GRID */
.grid-wrap { max-width:1280px; margin:0 auto; padding:0 0.8rem 5rem; }
.grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(155px,1fr)); gap:0.75rem; }
@media(max-width:400px){ .grid{grid-template-columns:repeat(2,1fr);gap:0.5rem} }

/* CARD */
.card {
  background:var(--card); border:1px solid var(--border); border-radius:var(--r);
  overflow:hidden; cursor:pointer; position:relative; user-select:none;
  transition:transform 0.15s,border-color 0.15s,box-shadow 0.15s;
  text-decoration:none; display:block; color:inherit;
}
.card:active { transform:scale(0.96); }
@media(hover:hover){
  .card:hover { transform:translateY(-3px) scale(1.015); border-color:var(--purple); box-shadow:0 8px 28px rgba(123,47,247,0.22); }
}
.card-art {
  aspect-ratio:3/2; width:100%;
  background:linear-gradient(135deg,#1e1e32,#0d0d1a);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  position:relative; overflow:hidden;
}
.card-art::before {
  content:''; position:absolute; inset:0;
  background:
    radial-gradient(circle at 25% 25%,rgba(123,47,247,0.14),transparent 60%),
    radial-gradient(circle at 75% 75%,rgba(255,60,120,0.09),transparent 60%);
}
.card-art .icon { font-size:2.2rem; position:relative; filter:drop-shadow(0 0 8px rgba(123,47,247,0.6)); }
.card-art .abbr { font-family:'Press Start 2P',monospace; font-size:0.32rem; color:rgba(255,255,255,0.3); position:relative; margin-top:0.3rem; text-align:center; max-width:80%; word-break:break-word; }
.card-body { padding:0.55rem 0.65rem 0.65rem; }
.card-title {
  font-size:0.72rem; font-weight:600; line-height:1.4; color:var(--text);
  display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; min-height:2em;
}
.card-meta { display:flex; gap:0.3rem; margin-top:0.35rem; align-items:center; flex-wrap:wrap; }
.badge { font-family:'Press Start 2P',monospace; font-size:0.3rem; padding:2px 5px; border-radius:3px; }
.b-gba { background:rgba(0,229,255,0.1);color:var(--cyan);border:1px solid rgba(0,229,255,0.25); }
.b-ita { background:rgba(255,230,0,0.08);color:var(--yellow);border:1px solid rgba(255,230,0,0.2); }
.card-size { font-size:0.62rem; color:var(--muted); margin-left:auto; }

/* LOADER */
#loader { display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 1rem;gap:1.2rem; }
.spinner { width:42px;height:42px;border-radius:50%;border:3px solid var(--border);border-top-color:var(--accent);border-right-color:var(--purple);animation:spin 0.75s linear infinite; }
@keyframes spin{to{transform:rotate(360deg)}}
.loader-txt { font-family:'Press Start 2P',monospace;font-size:0.45rem;color:var(--muted);letter-spacing:0.1em;animation:blink 1s step-end infinite; }
@keyframes blink{50%{opacity:0}}
#empty { display:none;text-align:center;padding:3rem 1rem;font-family:'Press Start 2P',monospace;font-size:0.5rem;color:var(--muted); }

/* TOP BTN */
#topbtn { position:fixed;bottom:1.2rem;right:1.2rem;width:42px;height:42px;border-radius:50%;background:var(--purple);border:none;color:white;font-size:1.1rem;cursor:pointer;display:none;align-items:center;justify-content:center;box-shadow:0 4px 14px rgba(123,47,247,0.45);z-index:200; }
#topbtn.on{display:flex}
</style>
</head>
<body>

<header>
  <div class="logo">GBA ARCADE<br>ITALIA</div>
  <div class="tagline">‚ñ∂ gameboy advance in italiano ‚óÄ</div>
</header>

<div class="search-wrap">
  <span class="si">üîç</span>
  <input type="text" id="searchInput" placeholder="Cerca... Pok√©mon, Mario, Zelda, Dragon Ball" autocomplete="off" spellcheck="false">
</div>
<div class="stats" id="stats">...</div>

<div class="grid-wrap">
  <div id="loader"><div class="spinner"></div><div class="loader-txt">Caricamento giochi...</div></div>
  <div id="empty">‚ùå Nessun risultato</div>
  <div class="grid" id="grid"></div>
</div>

<button id="topbtn" onclick="window.scrollTo({top:0,behavior:'smooth'})">‚Üë</button>

<script>
'use strict';
const ARCHIVE_ID = 'gba-italian-romset_202201';
const BASE_URL   = `https://archive.org/download/${ARCHIVE_ID}/`;
const META_URL   = `https://archive.org/metadata/${ARCHIVE_ID}`;

let allGames = [];

function cleanTitle(fn) {
  return fn.replace(/\.(zip|gba)$/i,'').replace(/_/g,' ')
    .replace(/\s*\([^)]*\)/g,'').replace(/\s*\[[^\]]*\]/g,'').trim() || fn;
}
function el(id){ return document.getElementById(id); }

async function loadGames() {
  try {
    const r = await fetch(META_URL);
    if (!r.ok) throw new Error('HTTP ' + r.status);
    const d = await r.json();
    allGames = (d.files || [])
      .filter(f => /\.(zip|gba)$/i.test(f.name) && !/_(?:files|meta|reviews)/.test(f.name))
      .map(f => ({
        name: f.name, title: cleanTitle(f.name),
        url: BASE_URL + encodeURIComponent(f.name),
        mb: f.size ? +(f.size/1048576).toFixed(1) : null
      }))
      .sort((a,b)=>a.title.localeCompare(b.title,'it'));
    el('loader').style.display = 'none';
    render(allGames); setStats(allGames.length, allGames.length);
  } catch(e) {
    el('loader').innerHTML = `<div style="font-family:'Press Start 2P',monospace;font-size:0.5rem;color:#ff4444;text-align:center;line-height:2.5">
      ‚ö† ERRORE<br><span style="font-size:0.38rem;opacity:0.6">Ricarica la pagina</span><br>
      <button onclick="location.reload()" style="margin-top:1rem;background:#7b2ff7;border:none;color:#fff;font-family:'Press Start 2P',monospace;font-size:0.38rem;padding:0.6rem 1rem;border-radius:6px;cursor:pointer;">‚Ü∫ RICARICA</button>
    </div>`;
  }
}

function render(games) {
  const grid = el('grid'), empty = el('empty');
  if (!games.length) { grid.innerHTML=''; empty.style.display='block'; return; }
  empty.style.display = 'none';
  const frag = document.createDocumentFragment();
  games.forEach(g => {
    const a = document.createElement('a');
    a.className = 'card';
    // Navigate to player.html with game params in URL
    a.href = `player.html?url=${encodeURIComponent(g.url)}&title=${encodeURIComponent(g.title)}`;
    a.innerHTML = `
      <div class="card-art">
        <span class="icon">üéÆ</span>
        <span class="abbr">${g.title.slice(0,18)}</span>
      </div>
      <div class="card-body">
        <div class="card-title">${g.title}</div>
        <div class="card-meta">
          <span class="badge b-gba">GBA</span>
          <span class="badge b-ita">ITA</span>
          ${g.mb ? `<span class="card-size">${g.mb}MB</span>` : ''}
        </div>
      </div>`;
    frag.appendChild(a);
  });
  grid.innerHTML = ''; grid.appendChild(frag);
}

function setStats(shown, total) {
  el('stats').textContent = shown === total ? `${total} giochi` : `${shown} / ${total} giochi`;
}

el('searchInput').addEventListener('input', function() {
  const q = this.value.trim().toLowerCase();
  const f = q ? allGames.filter(g=>g.title.toLowerCase().includes(q)||g.name.toLowerCase().includes(q)) : allGames;
  render(f); setStats(f.length, allGames.length);
});

window.addEventListener('scroll',()=>{ el('topbtn').classList.toggle('on', window.scrollY>400); });
loadGames();
</script>
</body>
</html>
