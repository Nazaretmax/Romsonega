<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Save Editor / Decoder</title>
<style>
body { font-family: monospace; background:#111; color:#0f0; padding:20px; }
button { margin:5px; padding:5px 10px; }
textarea { width:100%; height:200px; background:#000; color:#0f0; }
input { margin:5px; }
</style>
</head>
<body>

<h2>ðŸ›  Save File Decoder & Editor</h2>

<input type="file" id="fileInput">
<br>

<button onclick="showHex()">Mostra HEX</button>
<button onclick="extractStrings()">Trova Stringhe</button>

<br><br>

<label>Chiave XOR:</label>
<input type="text" id="xorKey" placeholder="Inserisci chiave">
<button onclick="applyXOR()">Decifra XOR</button>

<br><br>

<button onclick="downloadFile()">Scarica Save Modificato</button>

<h3>Output:</h3>
<textarea id="output"></textarea>

<script>
let fileBuffer = null;
let originalBuffer = null;

document.getElementById("fileInput").addEventListener("change", function(e) {
    const reader = new FileReader();
    reader.onload = function() {
        fileBuffer = new Uint8Array(reader.result);
        originalBuffer = new Uint8Array(reader.result);
        document.getElementById("output").value = "File caricato: " + fileBuffer.length + " bytes";
    };
    reader.readAsArrayBuffer(e.target.files[0]);
});

function showHex() {
    if(!fileBuffer) return;
    let hex = "";
    for(let i=0; i<fileBuffer.length; i++) {
        hex += fileBuffer[i].toString(16).padStart(2,"0") + " ";
        if((i+1)%16===0) hex += "\n";
    }
    document.getElementById("output").value = hex;
}

function extractStrings() {
    if(!fileBuffer) return;
    let text = "";
    let temp = "";
    for(let i=0; i<fileBuffer.length; i++) {
        let char = fileBuffer[i];
        if(char >= 32 && char <= 126) {
            temp += String.fromCharCode(char);
        } else {
            if(temp.length >= 4) text += temp + "\n";
            temp = "";
        }
    }
    document.getElementById("output").value = text;
}

function applyXOR() {
    if(!fileBuffer) return;
    let key = document.getElementById("xorKey").value;
    if(!key) return alert("Inserisci una chiave!");

    let keyBytes = new TextEncoder().encode(key);
    for(let i=0; i<fileBuffer.length; i++) {
        fileBuffer[i] ^= keyBytes[i % keyBytes.length];
    }

    document.getElementById("output").value = "XOR applicato!";
}

function downloadFile() {
    if(!fileBuffer) return;
    const blob = new Blob([fileBuffer], {type:"application/octet-stream"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "edited_save.dat";
    a.click();
}
</script>

</body>
  </html>
