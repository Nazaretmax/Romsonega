<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Smart Save Editor</title>

<style>
body{
  margin:0;
  background:#0f172a;
  font-family:system-ui;
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.box{
  background:#1e293b;
  padding:30px;
  border-radius:15px;
  width:90%;
  max-width:400px;
}
input,button{
  width:100%;
  padding:12px;
  margin:10px 0;
  border-radius:8px;
  border:none;
}
button{
  background:#00ff88;
  font-weight:bold;
  cursor:pointer;
}
small{opacity:0.7}
</style>
</head>
<body>

<div class="box">
<h2>ðŸ”¥ Save Editor Smart</h2>

<input type="file" id="fileInput">

<input type="number" id="currentValue" placeholder="Valore attuale (es: 56)">
<input type="number" id="newValue" placeholder="Nuovo valore">

<button onclick="smartEdit()">MODIFICA AUTOMATICAMENTE</button>

<button onclick="downloadFile()">Scarica Save</button>

<p id="status"></p>
<small>Prova automaticamente tutte le chiavi XOR</small>
</div>

<script>

let buffer=null;

document.getElementById("fileInput").addEventListener("change",e=>{
  const reader=new FileReader();
  reader.onload=()=>buffer=new Uint8Array(reader.result);
  reader.readAsArrayBuffer(e.target.files[0]);
});

function smartEdit(){
  if(!buffer) return alert("Carica un file");

  let current=parseInt(document.getElementById("currentValue").value);
  let newVal=parseInt(document.getElementById("newValue").value);

  let totalChanges=0;

  for(let xor=0;xor<256;xor++){

    // Scansione 1 BYTE
    for(let i=0;i<buffer.length;i++){
      if((buffer[i]^xor)===current){
        buffer[i]=(newVal^xor);
        totalChanges++;
      }
    }

    // Scansione INT32
    for(let i=0;i<buffer.length-3;i++){
      let b0=buffer[i]^xor;
      let b1=buffer[i+1]^xor;
      let b2=buffer[i+2]^xor;
      let b3=buffer[i+3]^xor;

      let num=b0|(b1<<8)|(b2<<16)|(b3<<24);

      if(num===current){
        buffer[i]=(newVal & 0xFF)^xor;
        buffer[i+1]=((newVal>>8)&0xFF)^xor;
        buffer[i+2]=((newVal>>16)&0xFF)^xor;
        buffer[i+3]=((newVal>>24)&0xFF)^xor;
        totalChanges++;
      }
    }
  }

  document.getElementById("status").innerText=
    "Modifiche effettuate: "+totalChanges;
}

function downloadFile(){
  if(!buffer) return;
  const blob=new Blob([buffer],{type:"application/octet-stream"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="edited_save.dat";
  a.click();
}

</script>

</body>
</html>
