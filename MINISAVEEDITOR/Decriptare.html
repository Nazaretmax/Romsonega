<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Save Editor</title>

<style>
body{
  margin:0;
  background:#0f172a;
  font-family:system-ui;
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.box{
  background:#1e293b;
  padding:25px;
  border-radius:15px;
  width:95%;
  max-width:420px;
}
input,button{
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:8px;
  border:none;
}
button{
  background:#00ff88;
  font-weight:bold;
  cursor:pointer;
}
small{opacity:0.6}
</style>
</head>
<body>

<div class="box">
<h2>ðŸ§  AI Save Editor</h2>

<label>Save 1</label>
<input type="file" id="file1">

<label>Save 2 (opzionale per confronto)</label>
<input type="file" id="file2">

<input type="number" id="currentValue" placeholder="Valore attuale">
<input type="number" id="newValue" placeholder="Nuovo valore">

<button onclick="aiEdit()">MODIFICA INTELLIGENTE</button>
<button onclick="download()">Scarica Save</button>

<p id="status"></p>
<small>Rilevamento automatico XOR + tipo dato</small>
</div>

<script>

let buf1=null;
let buf2=null;

document.getElementById("file1").addEventListener("change",e=>{
  const r=new FileReader();
  r.onload=()=>buf1=new Uint8Array(r.result);
  r.readAsArrayBuffer(e.target.files[0]);
});

document.getElementById("file2").addEventListener("change",e=>{
  const r=new FileReader();
  r.onload=()=>buf2=new Uint8Array(r.result);
  r.readAsArrayBuffer(e.target.files[0]);
});

function detectBestXOR(buffer){
  let bestKey=0;
  let bestScore=0;

  for(let key=0;key<256;key++){
    let score=0;
    for(let i=0;i<200 && i<buffer.length;i++){
      let val=buffer[i]^key;
      if(val>=32 && val<=126) score++;
    }
    if(score>bestScore){
      bestScore=score;
      bestKey=key;
    }
  }
  return bestKey;
}

function aiEdit(){
  if(!buf1) return alert("Carica almeno Save 1");

  let current=parseInt(document.getElementById("currentValue").value);
  let newVal=parseInt(document.getElementById("newValue").value);

  let xor=detectBestXOR(buf1);

  let changes=0;

  for(let i=0;i<buf1.length-3;i++){

    // 1 BYTE
    let val1=buf1[i]^xor;
    if(val1===current && current>0 && current<10000000){
      buf1[i]=(newVal^xor);
      changes++;
    }

    // INT32
    let b0=buf1[i]^xor;
    let b1=buf1[i+1]^xor;
    let b2=buf1[i+2]^xor;
    let b3=buf1[i+3]^xor;

    let num=b0|(b1<<8)|(b2<<16)|(b3<<24);

    if(num===current && current>0 && current<10000000){
      buf1[i]=(newVal & 0xFF)^xor;
      buf1[i+1]=((newVal>>8)&0xFF)^xor;
      buf1[i+2]=((newVal>>16)&0xFF)^xor;
      buf1[i+3]=((newVal>>24)&0xFF)^xor;
      changes++;
    }

    // ModalitÃ  confronto
    if(buf2 && i<buf2.length){
      if(buf1[i]!==buf2[i]){
        // prioritÃ  alle differenze reali
      }
    }
  }

  document.getElementById("status").innerText=
    "XOR rilevato: "+xor+" | Modifiche: "+changes;
}

function download(){
  if(!buf1) return;
  const blob=new Blob([buf1],{type:"application/octet-stream"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="edited_save.dat";
  a.click();
}

</script>
</body>
</html>
